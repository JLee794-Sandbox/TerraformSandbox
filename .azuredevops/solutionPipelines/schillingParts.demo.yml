name: '[SchillingParts] Demo Team Deployment'

parameters:
  - name: removeDeployment
    displayName: Remove deployed module
    type: boolean
    default: true
  - name: prerelease
    displayName: Publish prerelease module
    type: boolean
    default: false
  - name: versionOption
    displayName: Version option for module
    type: string
    default: patch
    values:
      - major
      - minor
      - patch

pr:
  branches:
    include:
    - features/*
    - main
  paths:
    include:
      - '/Solutions/SchillingParts/variables/pipeline.tfvars'
      - '/.azuredevops/solutionPipelines/schillingParts.demo.yml'
      - '/.azuredevops/pipelineTemplates/*.yml'
      - '/Solutions/SchillingParts/*.tf'
    exclude:
      - '/**/*.md'

trigger:
  batch: true
  branches:
    include:
      - main
  paths:
    include:
      - '/Solutions/SchillingParts/variables/pipeline.tfvars'
      - '/.azuredevops/solutionPipelines/schillingParts.demo.yml'
      - '/.azuredevops/pipelineTemplates/*.yml'
      - '/Solutions/SchillingParts/*.tf'
    exclude:
      - '/**/*.md'

variables:
  - name: serviceName
    value: 'schillingParts.demo'
  - template: '../../settings.yml'
  - name: modulePath
    value: '$(System.DefaultWorkingDirectory)/Solutions/SchillingParts/'
  - name: planName
    value: $(serviceName)_$(Build.BuildId).tfplan
  - name: tfvarsPath
    value: 'variables/pipeline.tfvars'

pool: 
  name: 'AIB-Win19-Selfhosted-VMSS2'

stages:
  - template: /.azuredevops/pipelineTemplates/stages.module.yml
    parameters:
      removeDeployment: '${{ parameters.removeDeployment }}'
      prerelease: '${{ parameters.prerelease }}'
      versionOption: '${{ parameters.versionOption }}'
